{% extends 'base.html'%}

{% block container %}

<style>
img {
  border-radius: 50%;
}
</style>

<div class="container" id="users-body-container">
  <div class="row" style="padding:10px">
    <div class=" col s12 m8 l8" >

            <!-- user controls -->
              <div class="row center-align" id="user-controls" >
                  <div class=" col s12 m4 l4" >
                      <a class="btn-small modal-trigger" href="#modal1"> Add User </a>
                  </div>
                  <div class=" col s12 m4 l4" >
                      <a class="btn-small modal-trigger disabled" href="#modal-edit-user" id="user-edit-button"> Update User </a>
                      <!--<a class="btn-small modal-trigger" href="#modal1"> Edit User </a>-->
                  </div>
                  <div class=" col s12 m4 l4" >
                      <a class="btn-small disabled" id="user-delete-button"> Deactivate </a>
                  </div>
              </div>
      <!-- end of user controls -->


          <table class="highlight">
              <thead>
                <tr>
                    <th> User </th>                    
                    <th> Email </th>
                    <th> Type </th>
                    <th> Choose </th>
                </tr>
              </thead>    
              <tbody>
                  {% for user in users %}
                <tr>
                  <td> {{ user.username }} </td>
                  <td> {{ user.email }} </td>
                  <td> {{ user.type }} </td>
                  
                  <td>
                      <label>
                          <input class="with-gap" name="group3" type="radio" id="user-radio-button"/>
                          <span> <a> </a></span>
                      </label>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
    </div>
    <div class=" col s12 m4 l4" >
              <!-- start of card -->

                <div class="row">
                    
                    <div class="card-panel teal hide" id="user-profile-details" style="height:100%">

                        <div class="" style="margin: 10%">
                            <h4 class="white-text">
                                Profile
                            </h4>
                        </div>
                        <!-- body -->
                        <div class="left-align" style="height:20%; margin-top:10%;">
                            <div class="row" > <!-- start of row -->

                                <div class="col s12 m6 l6">
                                  <div style="background-color: blue;height:70%; width: 80%; border-radius:50% ">
                                    <img src="{{ url_for('static', filename='images/user_male.png') }}" height="100%" width="100%"></image>
                                  </div>
                                </div>
                                <div class="col s12 m6 l6">

                                </div>

                            </div> <!-- end of row -->
                            <!-- start of row -->

                            <div class="row"> <!-- start of row -->

                                <div class="container">
                                    <p >
                                        User: <span style="padding-left:5px" class="white-text" id="user-details-username"> Sample</span>
                                    </p>
                                    <p >
                                        Email: <span style="padding-left:5px" class="white-text" id="user-details-email"> Sample</span>
                                    </p>
                                    <p >
                                        Company: <span style="padding-left:5px" class="white-text" id="user-details-company"> Sample</span>
                                    </p>
                                    </p>
                                    <p >
                                        Gender: <span style="padding-left:5px" class="white-text" id="user-details-gender"> Sample</span>
                                    </p>
                                </div> <!-- end of container -->
                            </div> <!-- end of row -->
                            <!-- end of row -->
                            </div>      
                        </div>
                        <!-- end of body -->
                        <!-- footer -->  
                </div>
                <!-- end of card -->
    </div>
    </div>
  <!-- end of table -->
          <!-- modals -->
            <!-- add new user modal -->
            <div id="modal1" class="modal modal-fixed-footer">
                <!-- Modal Structure -->

                <div class="modal-content">
                  
                      <!-- start of form -->
                        <div class="row">    
                            <form class="col s12" id="user-form">
                              <!-- row 1-->
                              <div class="row">
                                <div class="input-field col s6">
                                  <i class="material-icons prefix">account_circle</i>
                                  <input id="icon_fullname" type="text" class="validate">
                                  <label for="icon_fullname">Full Name</label>
                                </div>
                                <div class="input-field col s6">
                                  <i class="material-icons prefix">phone</i>
                                  <input id="icon_telephone" type="tel" class="validate">
                                  <label for="icon_telephone">Telephone</label>
                                </div>
                              </div>
                              <!-- row 2-->
                              <div class="row">
                                  <div class="input-field col s6">
                                    <i class="material-icons prefix">account_circle</i>
                                    <input id="icon_username" type="text" class="validate">
                                    <label for="icon_username">Username</label>
                                  </div>
                                  <div class="input-field col s6">
                                    <i class="material-icons prefix">phone</i>
                                    <input id="icon_gender" type="tel" class="validate">
                                    <label for="icon_gender">Gender</label>
                                  </div>
                                </div>
                                <!-- row 3 -->
                                <div class="row">
                                    <div class="input-field col s6">
                                      <i class="material-icons prefix">account_circle</i>
                                      <input id="icon_email" type="text" class="validate">
                                      <label for="icon_email"> Email </label>
                                    </div>
                                    <div class="input-field col s6">
                                      <i class="material-icons prefix">phone</i>
                                      <input id="icon_password" type="tel" class="validate">
                                      <label for="icon_password">Password</label>
                                    </div>
                                </div>
                                 <!-- <div class="row">
                                      <div class=" col s12 center-align" >
                                          <button class="btn-small"> Submit</button>
                                          <a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancel</a>
                                       </div>
                                  </div> -->
                            </form>
                          </div>
                      <!-- end of form -->
                </div>
                <div class="modal-footer">
                <!--<a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancel</a> -->
                  <button class="btn-small"> Submit</button>
                  <a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancel</a>
                </div>
            </div>
            <!-- end of user modal -->
            <!-- add edit user modal -->
            <div id="modal-edit-user" class="modal modal-fixed-footer">
                  <div class="modal-content">
                      <span style="size: 10px"> UPDATE USER DETAILS </span>
                      <hr/>
                      <!-- start of form -->
                      <div class="row">
                          <form class="col s12" id="user-form">

                              <div class="form-group"> {{ editform.csrf_token }} </div>

                              <div class="row">
                                  <div class="input-field col s6">
                                      
                                      {{ editform.company() }}
                                      <label for="icon_prefix"> {{ editform.company.label }} </label>
                                    </div>
                                    <div class="input-field col s6">
                                      
                                        {{ editform.email() }}
                                      <label for="icon_telephone"> {{ editform.email.label }}</label>
                                    </div>
                              </div>                
                              <div class="form-group">
                                  {{ editform.old_password.label }}: {{editform.old_password() }}
                              </div>
                              <div class="form-group">
                                  {{ editform.new_password.label }}: {{editform.new_password() }}
                              </div>
                              <div class="form-group">
                                  {{ editform.confirm_new_password.label }}: {{editform.confirm_new_password() }}
                              </div>
                              <div class="row">
                                  <div class=" col s12 center-align" >
                                      <!-- <button class="btn-small"> Submit</button>
                                      <a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancel</a> -->                                      
                                   </div>
                              </div>
                          </form>
                      </div>
                          <!-- end of form -->
                  </div>
                  <div class="modal-footer">
                      <button class="btn-small"> Submit</button>
                      <a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancel</a>
                  </div>
            </div>
            <!-- end of edit user modal -->
        <!-- end of modals -->
      </div> 

        <script>
          $(document).ready(function(){
            $("#admin-section").removeClass("hide");
            $("#link-users-management").addClass("active")     
            //$("#admin-section").addClass("show");            
            });
            $('#user-form').submit(function (e) {
                e.preventDefault();
                console.log('here');
            });
            $('input[type=radio][name=group3]').change(function() {
              var user = ''
              var $row = $(this).closest("tr"); 
              //alert($row);
              $tds = $row.find("td:nth-child(1)");
              //alert($tds);
              $.each($tds, function() {    
                  user = $(this) .text();     // Prints out the text within the <td>
              });
              var data = {
                'action': 'user-details',
                'user' : user
              }
              getUserDetails(data);
            }); 
            function getUserDetails(data_obj){             
              //$("#user-delete-button").removeClass("disabled");
              $("#users-body-container").removeClass('container');
              $.ajax({
                    type: "POST",
                    url: "{{url_for('admin.posts')}}",
                    data: data_obj,
                    success: function (data,txtStatus) {
                        if(txtStatus = 'success'){  
                          for(var i = 0; i < data.user.length; i++ ){

                              
                                  var username_a = data.user[i].username
                                  var username_b = data_obj.user

                                  username_a = username_a.replace(/\s+/g, '');
                                  username_b = username_b.replace(/\s+/g, '');

                                  if(username_a == username_b){
                                    console.log('true')
                                    $('#user-details-username').html(data.user[i].username)
                                    $('#user-details-email').html(data.user[i].email)
                                    $('#user-details-company').html(data.user[i].company)
                                    $('#user-details-gender').html(data.user[i].gender)

                                  }else {
                                    //console.log('false')
                                  }
                          }
                          $("#user-profile-details").removeClass("hide");
                          $("#user-edit-button").removeClass("disabled");
                        }else{
                          console.log('error');
                        } 
                    },
                    error: function(jqXHR){
                    console.log(jqXHR)
                    }
                }); 
            }
        
        </script>
         


{% endblock %}